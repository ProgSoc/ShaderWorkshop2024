{"name":"3. Shadows","goals":[],"shaders":[{"filename":"main.vert","contents":"#version 300 es\n\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\n\nuniform mat4 model;\nuniform mat4 view;\nuniform mat4 projection;\n\nuniform mat4 lightView;\nuniform mat4 lightProjection;\n\nout vec3 vNormal;\nout vec2 vUv;\nout vec4 vPos;\nout vec4 vLightUv;\n\nvoid main() {\n    vUv = uv;\n    vNormal = (model * vec4(normal, 0.)).xyz;\n    vPos = model * vec4(position, 1.);\n    vLightUv = lightProjection * lightView * vPos;\n    gl_Position = projection * view * vPos;\n}"},{"filename":"main.frag","contents":"#version 300 es\n\nprecision highp float;\n\nin vec3 vNormal;\nin vec2 vUv;\nin vec4 vPos;\nin vec4 vLightUv;\n\nout vec4 FragColor;\n\nuniform sampler2D shadowMap;\nuniform float time;\n\nfloat shadow() {\n    vec3 projCoords = vLightUv.xyz / vLightUv.w;\n    projCoords = projCoords * 0.5 + 0.5;\n\n    float distanceToCamera = projCoords.z;\n    vec2 shadowMapUv = projCoords.xy;\n\n    float shadow = 1.0;\n\n    // Caclulate shadows here \n\n    return shadow;\n}\n\nvoid main() {\n    vec3 normal = normalize(vNormal);\n    vec3 ambient = vec3(0.1, 0.2, 1);\n    vec3 sun = vec3(-1, -1, -1);\n\n    float angle = clamp(-dot(normalize(normal), normalize(sun)), 0., 1.);\n    float diffuseBrightness = angle;\n\n    vec3 cameraPosition = vec3(-8., 4., 8.);\n\n    vec3 viewDirection = normalize(vPos.xyz - cameraPosition);\n    vec3 reflectionDirection = normalize(2. * dot(normal, sun) * normal - sun);\n    float specularAngle = clamp(dot(viewDirection, reflectionDirection), 0., 1.);\n    vec3 specular = vec3(pow(specularAngle, 20.));\n\n    float F0 = 0.2;\n    float F = F0 + (1. - F0) * pow((1. - max(-dot(normal, viewDirection), 0.)), 3.);\n\n    float edgeLighting = (F) * 0.3;\n\n    vec3 final = mix((ambient) * diffuseBrightness, ambient, 0.1) \n        + specular * F * 3.\n        + edgeLighting;\n\n    // Multiply our brightness by our shadow.\n    final *= shadow();\n    \n    FragColor = vec4(final, 1.);\n}"},{"filename":"empty.frag","contents":"#version 300 es\n\nprecision highp float;\n\nout vec4 FragColor;\n\nvoid main() {\n    FragColor = vec4(1.);\n}"},{"filename":"shadowProj.vert","contents":"#version 300 es\n\nin vec3 position;\nin vec3 normal;\nin vec2 uv;\n\nuniform mat4 model;\nuniform mat4 view;\nuniform mat4 projection;\n\nvoid main() {\n    vec4 vPos = model * vec4(position, 1.);\n    gl_Position = projection * view * vPos;\n}"}],"pipelineGraph":{"nodes":[{"id":"0.4025455024919875","type":"uniform","position":{"x":6,"y":-75},"data":{"label":"uniform node","type":"projection","fov":45,"near":0.1,"far":100},"origin":[0.5,0],"measured":{"width":161,"height":160},"selected":false,"dragging":false},{"id":"0.5984985949643993","type":"uniform","position":{"x":-94,"y":350},"data":{"label":"uniform node","type":"view","x":-8,"y":4,"z":5,"targetX":-1,"targetY":1,"targetZ":-0.7,"upX":0,"upY":1,"upZ":0},"origin":[0.5,0],"measured":{"width":161,"height":331},"selected":false,"dragging":false},{"id":"0.6788965243760299","type":"shader","position":{"x":711,"y":50},"data":{"label":"shader node","shaderSourceFileName":"main.vert"},"origin":[0.5,0],"measured":{"width":221,"height":153},"selected":false,"dragging":false},{"id":"0.6883502327990607","type":"gl-program","position":{"x":1341,"y":200},"data":{"label":"gl-program node"},"origin":[0.5,0],"measured":{"width":131,"height":86},"selected":false,"dragging":false},{"id":"0.4656143492836935","type":"shader","position":{"x":886,"y":225},"data":{"label":"shader node","shaderSourceFileName":"main.frag"},"origin":[0.5,0],"measured":{"width":221,"height":104},"selected":false,"dragging":false},{"id":"0.9690603646205747","type":"window","position":{"x":1543.5,"y":225},"data":{"label":"window node"},"origin":[0.5,0],"measured":{"width":86,"height":40},"selected":false,"dragging":false},{"id":"0.07296797580900671","type":"uniform","position":{"x":281,"y":475},"data":{"label":"uniform node","type":"time"},"origin":[0.5,0],"measured":{"width":161,"height":73},"selected":false,"dragging":false},{"id":"0.3762754214092061","type":"macro","position":{"x":417,"y":675},"data":{"label":"macro node","name":"scene"},"origin":[0.5,0],"measured":{"width":133,"height":111},"selected":false,"dragging":false},{"id":"0.5024430674378506","type":"uniform","position":{"x":206,"y":-50},"data":{"label":"uniform node","type":"translation","x":0},"origin":[0.5,0],"measured":{"width":161,"height":160},"selected":false,"dragging":false},{"id":"0.15950623553268528","type":"gl-program","position":{"x":941,"y":675},"data":{"label":"gl-program node"},"origin":[0.5,0],"measured":{"width":131,"height":86},"selected":false,"dragging":false},{"id":"0.9874474568613121","type":"framebuffer","position":{"x":1138.5,"y":600},"data":{"label":"framebuffer node","scaleFactor":1,"resizeMode":"Nearest","isDepthMap":true},"origin":[0.5,0],"measured":{"width":126,"height":109},"selected":false,"dragging":false},{"id":"0.44183083112787824","type":"shader","position":{"x":786,"y":600},"data":{"label":"shader node","shaderSourceFileName":"empty.frag"},"origin":[0.5,0],"measured":{"width":221,"height":71},"selected":false,"dragging":false},{"id":"0.16182435250483107","type":"shader","position":{"x":761,"y":775},"data":{"label":"shader node","shaderSourceFileName":"shadowProj.vert"},"origin":[0.5,0],"measured":{"width":221,"height":120},"selected":false,"dragging":false},{"id":"0.44483423891033413","type":"uniform","position":{"x":256,"y":1000},"data":{"label":"uniform node","type":"view","fov":45,"near":0.1,"far":100,"x":4,"y":4,"z":4,"targetX":0,"targetY":0,"targetZ":0,"upX":0,"upY":1,"upZ":0},"origin":[0.5,0],"measured":{"width":161,"height":331},"selected":false,"dragging":false},{"id":"0.42358799011209314","type":"uniform","position":{"x":256,"y":800},"data":{"label":"uniform node","type":"projection","fov":74,"near":0.1,"far":100},"origin":[0.5,0],"measured":{"width":161,"height":160},"selected":false,"dragging":false}],"edges":[{"source":"0.4025455024919875","sourceHandle":"__output","target":"0.6788965243760299","targetHandle":"projection","id":"xy-edge__0.4025455024919875__output-0.6788965243760299projection","selected":false},{"source":"0.5984985949643993","sourceHandle":"__output","target":"0.6788965243760299","targetHandle":"view","id":"xy-edge__0.5984985949643993__output-0.6788965243760299view","selected":false},{"source":"0.6788965243760299","sourceHandle":"__output","target":"0.6883502327990607","targetHandle":"vert","id":"xy-edge__0.6788965243760299__output-0.6883502327990607vert","selected":false},{"source":"0.4656143492836935","sourceHandle":"__output","target":"0.6883502327990607","targetHandle":"frag","id":"xy-edge__0.4656143492836935__output-0.6883502327990607frag","selected":false},{"source":"0.6883502327990607","sourceHandle":"__output","target":"0.9690603646205747","targetHandle":"in","id":"xy-edge__0.6883502327990607__output-0.9690603646205747in","selected":false},{"source":"0.07296797580900671","sourceHandle":"__output","target":"0.4656143492836935","targetHandle":"time","id":"xy-edge__0.07296797580900671__output-0.4656143492836935time","selected":false},{"source":"0.3762754214092061","target":"0.6883502327990607","targetHandle":"geometry","id":"xy-edge__0.3762754214092061-0.6883502327990607geometry","selected":false},{"source":"0.5024430674378506","sourceHandle":"__output","target":"0.6788965243760299","targetHandle":"model","id":"xy-edge__0.5024430674378506__output-0.6788965243760299model","selected":false},{"source":"0.3762754214092061","target":"0.15950623553268528","targetHandle":"geometry","id":"xy-edge__0.3762754214092061-0.15950623553268528geometry","selected":false},{"source":"0.15950623553268528","sourceHandle":"__output","target":"0.9874474568613121","targetHandle":"in","id":"xy-edge__0.15950623553268528__output-0.9874474568613121in","selected":false},{"source":"0.44183083112787824","sourceHandle":"__output","target":"0.15950623553268528","targetHandle":"frag","id":"xy-edge__0.44183083112787824__output-0.15950623553268528frag","selected":false},{"source":"0.16182435250483107","sourceHandle":"__output","target":"0.15950623553268528","targetHandle":"vert","id":"xy-edge__0.16182435250483107__output-0.15950623553268528vert","selected":false},{"source":"0.44483423891033413","sourceHandle":"__output","target":"0.16182435250483107","targetHandle":"view","id":"xy-edge__0.44483423891033413__output-0.16182435250483107view","selected":false},{"source":"0.9874474568613121","sourceHandle":"out","target":"0.4656143492836935","targetHandle":"shadowMap","id":"xy-edge__0.9874474568613121out-0.4656143492836935shadowMap","selected":false},{"source":"0.42358799011209314","sourceHandle":"__output","target":"0.16182435250483107","targetHandle":"projection","id":"xy-edge__0.42358799011209314__output-0.16182435250483107projection","selected":false},{"source":"0.42358799011209314","sourceHandle":"__output","target":"0.6788965243760299","targetHandle":"lightProjection","id":"xy-edge__0.42358799011209314__output-0.6788965243760299lightProjection","selected":false},{"source":"0.44483423891033413","sourceHandle":"__output","target":"0.6788965243760299","targetHandle":"lightView","id":"xy-edge__0.44483423891033413__output-0.6788965243760299lightView","selected":false}]},"macros":[{"name":"scene","inputLabels":[],"graph":{"nodes":[{"id":"0.7254421557490351","type":"output","data":{},"position":{"x":325,"y":100},"measured":{"width":150,"height":50},"selected":false,"dragging":false},{"id":"0.5270824240425167","type":"inputs","data":{"inputLabels":{}},"position":{"x":-550,"y":-150},"measured":{"width":162,"height":62},"selected":false,"dragging":false},{"id":"0.8558785786199814","type":"geometry","position":{"x":104,"y":-175},"data":{"label":"geometry node","type":"Model","uniformOverrides":["model"],"modelSrc":"cube.obj"},"origin":[0.5,0],"measured":{"width":208,"height":169},"selected":false,"dragging":false},{"id":"0.26990307538008973","type":"geometry","position":{"x":104,"y":0},"data":{"label":"geometry node","type":"Model","uniformOverrides":["model"],"modelSrc":"sphere.obj"},"origin":[0.5,0],"measured":{"width":208,"height":169},"selected":false,"dragging":false},{"id":"0.2547230567857732","type":"geometry","position":{"x":104,"y":175},"data":{"label":"geometry node","type":"Model","uniformOverrides":["model"],"modelSrc":"monkey.obj"},"origin":[0.5,0],"measured":{"width":208,"height":169},"selected":false,"dragging":false},{"id":"0.4924650761530207","type":"uniform","position":{"x":-169,"y":-175},"data":{"label":"uniform node","type":"translation","y":0,"z":-2,"x":0},"origin":[0.5,0],"measured":{"width":162,"height":159},"selected":false,"dragging":false},{"id":"0.5557933679953182","type":"uniform","position":{"x":-169,"y":0},"data":{"label":"uniform node","type":"translation","y":2,"x":-3,"z":-1},"origin":[0.5,0],"measured":{"width":162,"height":159},"selected":false,"dragging":false},{"id":"0.7648602964324309","type":"uniform","position":{"x":-169,"y":175},"data":{"label":"uniform node","type":"translation","x":0.5,"z":1,"y":1.4},"origin":[0.5,0],"measured":{"width":162,"height":159},"selected":false,"dragging":false}],"edges":[{"source":"0.2547230567857732","sourceHandle":"__output","target":"0.7254421557490351","targetHandle":"in","id":"xy-edge__0.09229821433620944__output-0in","selected":false},{"source":"0.26990307538008973","sourceHandle":"__output","target":"0.7254421557490351","targetHandle":"in","id":"xy-edge__0.7092132330014198__output-0in","selected":false},{"source":"0.8558785786199814","sourceHandle":"__output","target":"0.7254421557490351","targetHandle":"in","id":"xy-edge__0.15687022720788857__output-0in","selected":false},{"source":"0.4924650761530207","sourceHandle":"__output","target":"0.8558785786199814","targetHandle":"model","id":"xy-edge__0.835459651683528__output-0.25163250135530624model","selected":false},{"source":"0.5557933679953182","sourceHandle":"__output","target":"0.26990307538008973","targetHandle":"model","id":"xy-edge__0.29017415420774983__output-0.3794801820851914model","selected":false},{"source":"0.7648602964324309","sourceHandle":"__output","target":"0.2547230567857732","targetHandle":"model","id":"xy-edge__0.2229827157283073__output-0.9394445600187695model","selected":false}]}}]}